@namespace Theatre_TimeLine.Pages

@using Theatre_TimeLine.Contracts
@using Theatre_TimeLine.Models
@using Theatre_TimeLine.Components

@page "/RoadToThere/{TenantId?}"

@inject ITenantManagerService TenantManagerService
@inject NavigationManager NavigationManager

@if (tenant is null)
{
    <MudText>Loading...</MudText>
    return;
}

<MudTabs Elevation="2" Rounded="true" ApplyEffectsToContainer="true">
    <div style="margin: auto;width: 75%;padding: 10px;">
        @foreach (IRoadToThere road in tenant.Roads)
        {
            <MudTabPanel Text="@road?.Title">
                <MudText>@road?.Description</MudText>
                <img src="@road?.Banner" alt="@road?.Description" style="margin: auto;width: 75%;padding: 10px;" />
                <MudTimeline>
                    @for (int i = 0; i <= road?.Duration; i++)
                    {
                        <Block Road="road" BlockIndex="i" Class="align-content-center" />
                    }
                </MudTimeline>
            </MudTabPanel>
        }
    </div>
</MudTabs>

@code {

    private ITenantContainer? tenant;

    [Parameter]
    public string? TenantId { get; set; } = string.Empty;

    protected override async Task OnInitializedAsync()
    {
        if (string.IsNullOrEmpty(TenantId))
        {
            UriBuilder uri = new (NavigationManager.BaseUri);
            uri.Path = $"RoadToThere/{Theatre_TimeLine.Services.TenantManagerService.DemoGuid}/{Theatre_TimeLine.Services.TenantManagerService.DemoGuid}";
            NavigationOptions options = new()
                {
                    ForceLoad = true,
                    ReplaceHistoryEntry = true
                };
            NavigationManager.NavigateTo(uri.Uri.AbsoluteUri, options);
            return;
        }

        tenant = TenantManagerService.GetTenant(Guid.Parse(TenantId));
        await base.OnInitializedAsync();
    }
}
